# تحديثات النظام - 29 أغسطس 2025

## المشاكل التي تم حلها:

### 1. مشكلة أرقام الهواتف في الرسائل الجماعية
**المشكلة:** كان النظام يقول "لا توجد أقساط لهذا الرقم" عند محاولة إرسال رسائل جماعية

**الحل:**
- تم إصلاح استعلام قاعدة البيانات لجلب `whatsapp_number` من جدول الأقساط
- تم تحديث منطق التحقق من وجود رقم الهاتف
- تم إضافة حقل `whatsapp_number` اختياري للعملاء والأقساط

### 2. إضافة إمكانية حذف الأقساط
**الميزة الجديدة:**
- إضافة زر "حذف" لكل قسط في قائمة الأقساط
- حوار تأكيد الحذف مع تفاصيل القسط
- حذف تلقائي لجميع المدفوعات المرتبطة بالقسط
- تحذير واضح بأن الحذف نهائي ولا يمكن التراجع عنه

## التغييرات التقنية:

### ملفات تم تعديلها:
1. `src/pages/WhatsAppReminders.tsx` - إصلاح مشكلة أرقام الهواتف
2. `src/pages/Installments.tsx` - إضافة إمكانية الحذف
3. `supabase/migrations/20250829_add_whatsapp_fields.sql` - migration جديدة

### قاعدة البيانات:
- إضافة حقل `whatsapp_number` إلى جدول `customers`
- إضافة حقل `whatsapp_number` إلى جدول `installments`
- تحديث البيانات الموجودة لنسخ أرقام الهواتف إلى `whatsapp_number`

## كيفية استخدام الميزات الجديدة:

### إرسال رسائل WhatsApp:
1. تأكد من إضافة رقم WhatsApp للعملاء
2. يمكنك إضافة رقم WhatsApp مختلف عن رقم الهاتف العادي
3. النظام سيستخدم رقم WhatsApp إذا كان موجوداً، وإلا سيستخدم رقم الهاتف

### حذف الأقساط:
1. اذهب إلى صفحة "إدارة الأقساط"
2. اضغط على زر "حذف" بجانب القسط المطلوب
3. اقرأ التفاصيل في حوار التأكيد
4. اضغط "حذف نهائياً" للتأكيد

## ملاحظات مهمة:
- الحذف نهائي ولا يمكن التراجع عنه
- تأكد من عمل نسخة احتياطية من البيانات قبل الحذف
- أرقام WhatsApp يمكن أن تكون مختلفة عن أرقام الهواتف العادية
- النظام يدعم الآن إرسال رسائل للأقساط التي لها أرقام WhatsApp صالحة
